---
title: "Homework 5"
author: "Eileen Shea"
date: "November 15, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

library(tidyverse)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

## Problem 1

First we create a dataframe containing all of the file names.

```{r}
df = tibble(
  file_name = list.files("./data", full.names = TRUE)
)
```

Next we iterate over file names and read in data for each subject using `purrr::map`. We will save the result as a new variable in the dataframe. 

```{r}
read_file = function(file_name) {
  read_csv(file_name)
}
```

```{r}
df_untidy =  
  df %>% 
mutate(
  file_data = map(file_name, read_file)
) 
```

Finally we need to tidy the resulting dataframe.

```{r}
df_tidy =
  df_untidy %>% 
  unnest() %>% 
  separate(file_name, c("arm", "subject"), sep = "_") %>% 
  separate(subject, c("subject_ID", "remove")) %>% 
  mutate(arm = recode(arm, "./data/con" = "control", "./data/exp" = "experimental")) %>% 
  gather(key = week, value = response, week_1:week_8) %>% 
  separate(week, c("remove2", "week"), sep = "_") %>% 
  select(-remove, -remove2) %>% 
  mutate(week = as.numeric(week)) %>% 
  arrange(arm, subject_ID)
```

With our tidy dataset we will make a spaghetti plot showing observations on each subject over time.

```{r}
df_tidy %>% 
  ggplot(aes(x = week, y = response, color = subject_ID)) +
  geom_line() +
  facet_grid(~arm)
```

Based on this plot, we see that the experimental group saw increases in response over time, while the control group generally stayed the same over time with some fluctuations by week and possibly even a slight downward trend. 

## Problem 2

First we need to read in the data.

```{r}
homicide_data = read_csv("./data/homicide-data.csv")
```

The raw data includes `ncol(homicide_data)` variables and `nrow(homicide_data)` observations; each observation represents an individual homicide case. Variables include a unique ID that incorporates location information, date the homicide was reported, victim information (last name, first name, race, age, sex), city, state, latitude and longitude of the incident, and the disposition (i.e. status) of the case. Unidentifiable characteristics are reported as 'Unknown'. 

Next we will create a `city_state` variable.

```{r}
US_hom_data = homicide_data %>% 
  mutate(city_state = str_c(city, state, sep = ", "))
```





  

